<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Category Result</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      #detectedItems {
        margin: 20px 0;
      }
      #detectedItems ul {
        list-style-type: none;
        padding: 0;
      }
      #detectedItems li {
        padding: 5px 0;
        font-size: 16px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
      }
      table, th, td {
        border: 1px solid black;
      }
      th, td {
        padding: 8px;
        text-align: left;
      }
      img {
        max-height: 100px;
      }
    </style>
  </head>
  <body>
    <h2>Detected Items</h2>
    <div id="detectedItems">
      <!-- Detected items will be inserted here -->
    </div>

    <h2>Product List</h2>
    <table id="productsTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Image</th>
          <th>Price</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows will be dynamically inserted here -->
      </tbody>
    </table>

    <script>
      // Extract and display detected items
      const urlParams = new URLSearchParams(window.location.search);
      const detectedItems = urlParams.get('detected_items');
      const detectedItemsDiv = document.getElementById('detectedItems');

      if (detectedItems) {
        const itemsArray = decodeURIComponent(detectedItems).split(' ');
        const itemsList = document.createElement('ul');
        itemsArray.forEach(item => {
          const li = document.createElement('li');
          li.textContent = item;
          itemsList.appendChild(li);
        });
        detectedItemsDiv.appendChild(itemsList);
      } else {
        detectedItemsDiv.textContent = 'No detected items found.';
      }

      // Fetch and display products from database
      fetch('/products')
        .then(response => response.json())
        .then(data => {
          const tbody = document.getElementById('productsTable').querySelector('tbody');
          data.forEach(product => {
            const row = document.createElement('tr');
            const nameCell = document.createElement('td');
            nameCell.textContent = product.name;
            row.appendChild(nameCell);
            const imageCell = document.createElement('td');
            const img = document.createElement('img');
            img.src = product.url;
            img.alt = product.name;
            imageCell.appendChild(img);
            row.appendChild(imageCell);
            const priceCell = document.createElement('td');
            priceCell.textContent = product.price;
            row.appendChild(priceCell);
            tbody.appendChild(row);
          });
        })
        .catch(error => console.error('Error fetching products:', error));
    </script>
  </body>
</html>